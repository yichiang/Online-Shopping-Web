@using OnlineShoppingWeb.ViewModels
@model CheckoutPageViewModel
<div class="container">
    <div class="panel panel-default">
        <div class="panel-heading">Shipping address</div>
        <div class="panel-body">
            @if (Model.ShippingAddress != null)
            {
                <h1>@Model.ShippingAddress</h1>
            }
            else
            {
                using (Html.BeginForm("AddShippingAddress", "Checkout", FormMethod.Post, new { @class = "" }))
                {
                    <input type="text" name="ShippingAddress" />

                    <button class="change-qty-submit-button" type="submit"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>Place Order</button>
                }
            }
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">Review items and shipping</div>
        <div class="panel-body">
            <table class="table">
                @foreach (var product in Model.Products)
            {
                    <tr>
                        <th>@product.Title</th>
                        <th>@product.Price</th>
                        <th>@product.Quantity</th>
                    </tr>
                }
            </table>

        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">Total is @Model.Total</div>
        <div class="panel-body">
            <form action="Checkout/PlaceOrder" method="POST">
                <input type="hidden" name="ShippingAddress" value="@Model.ShippingAddress" />
                <input type="hidden" name="Total" value="@Model.Total" />
                <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                        data-key="@(Environment.GetEnvironmentVariable("StripePublicKey"))"
                        data-amount="@(Model.Total*100)"
                        data-name="Online Shopping Website"
                        data-description="2 widgets"
                        data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
                        data-locale="auto">
                </script>
            </form>
        </div>
    </div>
</div>
