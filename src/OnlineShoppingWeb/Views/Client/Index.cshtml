@using OnlineShoppingWeb.ViewModels;
@using System.Linq;

@model ClientProductPageViewModel
@if (Model.IsSearchAreaVisible)
{
    @using (Html.BeginForm("Index", "Client", FormMethod.Get, new { @class = "SearchForm" }))
    {
        @Html.HiddenFor(model => model.EventCommand)
        <div class="panel panel-default">
            <div class="panel-heading">Product</div>
            <div class="panel-body">

                <div class="form-group">
                    @Html.LabelFor(model => model.ProductSearchName)
                    @Html.TextBoxFor(model => model.ProductSearchName, new { @class = "form-control" })
                </div>
            </div>
            <div class="panel-footer">
                <button class="btn own-btn-action" value="search"> <span class="glyphicon glyphicon-search" aria-hidden="true"></span>Search</button>
                <button class="btn own-btn-action" value="list"> <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>Reset</button>

            </div>
        </div>

    }
}

@if (Model.IsListAreaVisible)
{
    <h1>Product Browser -Client</h1>

    <div class="table-responsive">

        <table class="table">
            <tr>
                <th>Title</th>
                <th>Price</th>
                <th>SubDepartment</th>
                <th>Condition</th>
                <th>Rating</th>
                <th>Quantity</th>
                <th>AddToCart</th>
                <th>View Detail</th>

            </tr>
            @foreach (var product in Model.Products)
            {
                <tr>
                    @if (@product.Title.Length > 60)
                    {
                        <th>@product.Title.Substring(0, 59) ...</th>
                    }
                    else
                    {
                        <th>@product.Title</th>

                    }
                    <th>$ @product.Price</th>
                    <th>@product.Discriminator</th>
                    <th>@product.Condition</th>

                    <th>@Html.Partial("_StarReview", product.AvgCustomerReview)</th>
                    <th>@product.Quantity</th>

                    <th>
                        @using (Html.BeginForm("AddToCart", "Client", FormMethod.Post, new { @class = "" }))
                        {
                            <input type="hidden" value="@product.ProductId" name="SaveToCartProductId" />

                            <button class="btn" type="submit" value="AddToCart"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span>AddToCart</button>
                        }
                    </th>
                    <th>
                        @using (Html.BeginForm("Index", "Client", FormMethod.Get, new { @class = "DetailForm" }))
                    {

                            <input type="hidden" value="detail" name="EventCommand" />
                            <input type="hidden" value="@product.ProductId" name="SaveToCartProductId" />
                            <input type="hidden" value="@product.Discriminator" name="ProductType" />
                            <button class="btn own-btn-detail" type="submit" value="detail"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>Detail</button>
                        }
                    </th>
                </tr>
            }
            <tr>
                @if (Model.EventCommand != "search")
                {
                    @Html.Partial("_PageDisplay", Model.AllProductsCount)

                }
     

            </tr>
        </table>
    </div>

}
@if (Model.IsDetailAreaVisible)
{
    if (Model.Product != null)
    {
        <div class="table-responsive">

            <table class="table">
                <tr>
                    <th>Title</th>
                    <th>Price</th>
                    <th>SubDepartment</th>
                    <th>Condition</th>
                    <th>Rating</th>
                    <th>Quantity</th>
                    <th>Brand</th>

            @if (Model.Product.Discriminator == "Laptop")
            {

                    <th>LaptopModel</th >
                    <th> ScreenSize</th >
                    <th> HardDrive</th >
                    <th>Processor</th >
            }else if (Model.Product.Discriminator == "Phone")
                    {

        
                        <th> ScreenSize</th>
                        <th> Carrier</th>
                    }
                </tr>

                <tr>
                    <th>@Model.Product.Title</th>
                    <th>@Model.Product.Price</th>
                    <th>@Model.Product.SubDepartment</th>
                    <th>@Model.Product.Condition</th>
                    <th>@Model.Product.AvgCustomerReview</th>
                    <th>@Model.Product.Quantity</th>
                    <th>@Model.Product.Brand</th>

                    @if (Model.Product.Discriminator == "Laptop")
                    {

                        <th>@Model.Laptop.LaptopModel</th>
                        <th> @Model.Laptop.ScreenSize</th>
                        <th>@Model.Laptop. HardDrive</th>
                        <th>@Model.Laptop.Processor</th>
                    }
                    else if (Model.Product.Discriminator == "Phone")
                    {


                        <th> @Model.Phone.ScreenSize</th>
                        <th> @Model.Phone.Carrier</th>
                    }
                </tr>
            </table>
        </div>
}

}
@using (Html.BeginForm("Index", "Client", FormMethod.Get, new { @class = "addMoretoListForm" }))
{
@Html.Partial("_PageControlForm", Model)
}



        @section ownScript
{
            <script>
                $(document).ready(function () {
                    //window.scrollTo(0, parseInt($("#windowPostiton").val()));
                    $(".own-btn-action").click(function (e) {
                        e.preventDefault();
                        $("#EventCommand").val($(this).val());
                        $("form.SearchForm").submit();
                    });

                    $(".pageButton").click(function () {
                        var pageRange = $(this).text();
                        console.log(pageRange);
                        if (pageRange === "All") {
                            console.log("All");

                            $("#TakeDisplayList").val($("#AllProductsCount").val());
                            $("#SkipDisplayList").val("0");

                        } else {
                            var tempArray = pageRange.split("-");
                            console.log(tempArray);
                            $("#TakeDisplayList").val("5");
                            $("#SkipDisplayList").val(parseInt(tempArray) - 1);
                        }
                        $("form.addMoretoListForm").submit();

                    });
                });

            </script>
        }
